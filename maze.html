<html>
	<head>
		<style>
			.maze {
				
			}
			
			.cell {
				border: 1px solid rgba( 0, 0, 0, 0.25 );
				float: left;
				box-sizing: border-box;
			}
			
			.neighbor {
				background-color: rgba( 0, 0, 255, 0.5 );
			}
			
			.visited {
				background-color: rgba( 255, 0, 0, 0.5 );
			}
			
			.complete {
				background-color: rgba( 0, 255, 0, 0.5 );
				border-color: #000000;
			}
			
			.start {
				background-color: rgba( 0, 0, 255, 0.5 );
			}
			
			.finish {
				background-color: rgba( 255, 0, 255, 0.5 );
			}
			
			.s {
				border-bottom: 0;
			}
			
			.n {
				border-top: 0;
			}
			
			.e {
				border-right: 0;
			}
			
			.w {
				border-left: 0;
			}
			
		</style>
		
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
		
		<script>
			var height = 45;
			var width = 75;
			var cellSize = 10;
			var activeSet = [];
			var split = 10;
			var cells = [];
			
			var passageToClass = function( v ) {
				switch( v ) {
					case 0:
						return 'n';
						
					case 1:
						return 's';
					
					case 2: 
						return 'e';
						
					case 3:
						return 'w';
						
					default:
						return '';
				}
			};
			
			var inversePassage = function( p ) {
				switch( p ) {
					case 3:
						return 'e';
						
					case 2:
						return 'w';
					
					case 1:
						return 'n';
						
					case 0:
						return 's';
						
					default:
						return '';
				}
			};
			
			var getUnvisitedNeighbors = function( $cell ) {
				var result = [], $current
					pos = $cell.attr( 'id' ).split( '-' ),
					x = parseInt( pos[ 0 ], 10 ), y = parseInt( pos[ 1 ], 10 );
					
				// North
				if ( y !== 0 ) {
					$current = cells[ y - 1 ][ x ];
					
					if ( !$current.hasClass( 'visited' ) ) {
						result.push( { cell: $current, direction: 0 } );						
					}
				}
				
				// West
				if ( x !== 0 ) {
					$current = cells[ y ][ x - 1 ];
					
					if ( !$current.hasClass( 'visited' ) ) {
						result.push( { cell: $current, direction: 3 } );						
					}
				}
				
				// South
				if ( y !== height - 1 ) {
					$current = cells[ y + 1 ][ x ]; 
					
					
					if ( !$current.hasClass( 'visited' ) ) {
						result.push( { cell: $current, direction: 1 } );						
					}
				}
				
				// East				
				if ( x !== width - 1 ) {
					$current = cells[ y ][ x + 1 ];
					
					if ( !$current.hasClass( 'visited' ) ) {
						result.push( { cell: $current, direction: 2 } );						
					}
				}
				
				if ( result.length === 0 ) {
					$cell.addClass( 'complete' );
					return false;
				}
				
				return result;
			}
			
			var clearComplete = function() {
				for ( var i = 0; i < activeSet.length; i++ ) {
					if ( activeSet[ i ].hasClass( 'complete' ) ) {
						activeSet.splice( i, 1 );
						return;
					}
				}
			}
		
			var drawgrid = function( h, w ) {
				var $maze = $( '.maze' ), i, j;
				
				for( i = 0; i < h; i++ ) {
					cells[ i ] = [];
					for( j = 0; j < w; j++ ) {
						cells[ i ].push( $( '<div id="' + j + '-' + i + '" class="cell" style="width:' + cellSize + 'px;height:' + cellSize +'px" />' ).appendTo( $maze ) );
					}
				}
				
				$maze.width( w * cellSize ).height( h * cellSize );
			};
			
			var distance = 0, maxDistance = 0;
		
			$( document ).ready( function() {
				drawgrid( height, width );
				
				var $current, $new, neighbors, direction, n;
				
				activeSet.push( $( '#' + Math.floor( Math.random() * width ) + '-' +  Math.floor( Math.random() * height ) ).addClass( 'visited start' ).attr( 'data-distance', distance ) );
				
				var draw = function() {
					n = Math.floor( Math.random() * 100 );
						
					if ( n < split ) {
						n = Math.floor( Math.random() * activeSet.length );
					} else {
						n = activeSet.length - 1;
					}
										
					$current = activeSet[ n ];
					distance = parseInt( $current.attr( 'data-distance' ), 10 );
					maxDistance = Math.max( maxDistance, distance );
					neighbors = getUnvisitedNeighbors( $current );
					
					if( neighbors.length ) {
						n = Math.floor( Math.random() * neighbors.length );
						$new = neighbors[ n ];						
						activeSet.push( $new.cell.addClass( 'visited ' + inversePassage( $new.direction ) ).attr( 'data-distance', distance + 1 ) );
						$current.addClass( passageToClass( $new.direction ) );
					} else {					
						clearComplete();
					}
					
					if ( activeSet.length ) {
						window.setTimeout( draw, 1 );
					} else {
						$( 'div[data-distance=' + maxDistance + ']' ).addClass( 'finish' );
					}
				}
				
				window.setTimeout( draw, 1 );
				
			} );
		</script>
	</head>
	<body>
		<div class="maze">
			
		</div>
	</body>
</html>